# 阶段三：前端 UI 实现 - 核心交互界面

本文档指导你构建 Deep-Research-AI-Agent 项目的核心用户交互界面。

## 任务 3.1：创建主页面基本布局

**目标**：在 `app/page.tsx` 中设置主页面的基本结构，包括输入区域、消息显示区域和可能的侧边栏或控制面板区域的占位符。

**LLM 提示词**：
```
请指导我修改 Next.js 项目的 `app/page.tsx` 文件，为其创建一个基本的页面布局。
要求如下：
1.  页面应使用 Tailwind CSS 进行布局和样式化。
2.  顶部可以有一个简单的应用标题或 Logo 占位符。
3.  主要内容区域应分为：
    a.  一个用于显示聊天消息或研究结果的区域 (占位)。
    b.  一个底部固定的输入区域，包含一个文本输入框和一个发送按钮 (占位)。
4.  可以考虑为未来的研究控制面板或工具栏预留空间 (例如，在左侧或右侧的侧边栏占位)。
5.  确保页面在不同屏幕尺寸下具有基本的响应式行为。
6.  引入并使用之前创建的 `ThemeToggle` 组件，以便用户可以切换主题。
```

**测试**：
1.  运行开发服务器 (`npm run dev`)。
2.  在浏览器中打开 `http://localhost:3000`。
3.  你应该能看到一个包含标题、空的聊天显示区域、输入框和发送按钮的页面基本框架。
4.  确认 `ThemeToggle` 组件可见并且可以正常切换主题。
5.  调整浏览器窗口大小，检查页面布局是否能做出基本的响应式调整。

## 任务 3.2：实现聊天消息输入与提交

**目标**：使用 `react-hook-form` 和 `@ai-sdk/react` 的 `useChat` hook (或类似的状态管理) 来处理用户输入，并将消息发送到后端 API。

**LLM 提示词 (useChat 集成)**：
```
我需要在我的 `app/page.tsx` 组件中集成 Vercel AI SDK 的 `useChat` hook (或者如果我使用的是其他 AI SDK，请提供相应的 hook 指导)。
请指导我如何进行以下操作：
1.  在 `app/page.tsx` (它应该是一个客户端组件 `'use client'`) 中导入并初始化 `useChat` hook。需要配置 `api` 选项指向我们之前创建的 `/api/chat` 端点。
2.  `useChat` hook 会提供 `messages`, `input`, `handleInputChange`, `handleSubmit` 等状态和函数。将这些与UI元素绑定：
    a.  将 `input` 的值绑定到文本输入框。
    b.  将 `handleInputChange` 绑定到文本输入框的 `onChange` 事件。
    c.  将 `handleSubmit` (或者一个调用它的自定义函数) 绑定到表单的 `onSubmit` 事件或发送按钮的 `onClick` 事件。
```

**LLM 提示词 (表单和输入组件)**：
```
请指导我使用 Shadcn UI 组件 (如 `Input` 和 `Button`) 和 `react-hook-form` (如果适用，或者直接使用 `useChat` 提供的 `handleSubmit`) 来构建消息输入表单。
这个表单应该包含：
1.  一个 `Input` 组件用于用户输入文本。
2.  一个 `Button` 组件用于提交表单。
当用户提交表单时，应该调用 `useChat` hook 提供的 `handleSubmit` 函数。
```

**测试**：
1.  运行开发服务器。
2.  在浏览器中打开 `http://localhost:3000`。
3.  在输入框中输入文字，然后点击发送按钮或按 Enter 键。
4.  **网络检查**：打开浏览器的开发者工具 (网络面板)，确认当提交消息时，有一个 POST 请求发送到 `/api/chat`。
5.  **API 响应 (初步)**：检查该请求的响应。由于后端 API 在阶段二只是返回模拟数据或 LLM 的初步响应，你应该能在网络响应中看到这些流式数据。
6.  **状态检查 (可选)**：如果使用 React DevTools，可以检查 `useChat` hook 的 `messages` 状态是否在提交后有所更新 (例如，添加了用户的消息，并开始接收来自 API 的流式响应)。

## 任务 3.3：显示聊天消息列表

**目标**：将 `useChat` hook 返回的 `messages` 数组渲染到页面上，区分用户消息和 AI 助手消息，并处理 Markdown 格式。

**LLM 提示词**：
```
请指导我如何在 `app/page.tsx` 中渲染由 `useChat` hook 提供的 `messages` 数组。
要求如下：
1.  遍历 `messages` 数组。
2.  为每条消息创建一个独特的 `key`。
3.  根据消息的 `role` (`user` 或 `assistant`) 应用不同的样式或布局，以便区分发言者。
4.  使用 `react-markdown` 组件 (以及 `remark-gfm` 插件) 来渲染消息的 `content`，使其能够正确显示 Markdown 格式，包括代码块。
5.  为代码块集成 `react-syntax-highlighter` 以实现语法高亮。选择一个合适的主题 (例如 `atomDark` 或 `vs2015`)。
6.  确保消息列表区域可以滚动，并且当新消息出现时能自动滚动到底部 (可选，但推荐)。
```

**测试**：
1.  运行开发服务器。
2.  在浏览器中与聊天机器人进行几次交互。
3.  确认用户发送的消息和 AI 返回的消息都能显示在聊天区域。
4.  确认用户消息和 AI 消息有明显的视觉区分。
5.  如果 AI 的响应包含 Markdown (例如列表、粗体、代码块)，确认它们被正确渲染。
6.  确认代码块有语法高亮。
7.  如果实现了自动滚动，确认新消息出现时视图会自动滚动到底部。

## 任务 3.4：处理加载状态和错误提示

**目标**：在与 AI 交互时，向用户显示加载指示器，并在发生错误时提供有用的错误信息。

**LLM 提示词**：
```
请指导我如何在 `app/page.tsx` 中处理加载状态和错误。
`useChat` hook 通常会提供 `isLoading` 状态和 `error` 对象。
我需要：
1.  当 `isLoading` 为 `true` 时 (例如，等待 AI 响应时)，在界面上显示一个加载指示器。这可以是一个简单的文本提示 ("AI 正在思考...")，或者一个 Shadcn UI 的 `Progress` 组件或旋转图标。
2.  当 `error` 对象存在时，在界面上显示一个错误提示信息。可以使用 Shadcn UI 的 `Sonner` (toast) 组件来显示错误。
3.  确保在加载完成或新请求开始时，错误信息会被清除。
```

**测试**：
1.  **加载状态测试**：
    *   运行开发服务器。
    *   发送一条消息给 AI。在 AI 响应期间，你应该能看到加载指示器。
    *   AI 响应完成后，加载指示器应该消失。
2.  **错误状态测试**：
    *   模拟一个 API 错误。一种方法是临时修改 `/api/chat` 的 URL (例如，在 `useChat` 的 `api` 配置中故意写错路径)，或者在 API 路由中强制抛出一个错误。
    *   发送一条消息。
    *   你应该能在界面上看到一个错误提示 (例如，通过 Sonner toast 显示)。
    *   修复错误后 (例如，改回正确的 API 路径)，再次发送消息，错误提示不应再出现，交互应恢复正常。

---

完成此阶段后，你的应用将拥有一个功能基本齐全的聊天界面，能够与后端 AI 服务进行交互并显示结果。 